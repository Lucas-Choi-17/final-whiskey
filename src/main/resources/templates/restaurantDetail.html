<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <th:block th:replace="fragments/header :: headerfiles"></th:block>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/restaurantDetail.css}">
    <link rel="stylesheet" th:href="@{/css/restaurantDetail/info.css}">
    <link rel="stylesheet" th:href="@{/css/restaurantDetail/reviews.css}">
    <link rel="stylesheet" th:href="@{/css/restaurantDetail/inquiries.css}">
    <link rel="stylesheet" th:href="@{/css/restaurantDetail/notices.css}">
    <link rel="stylesheet" href="/css/common.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!--  카카오 api key 를 받아오는 js  -->
    <script src="/js/kakaoMapApiSource.js"></script>
    <title>FoodPolio - 음식점 상세 정보</title>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<!-- TODO: 백엔드 개발
1. 레스토랑 정보를 데이터베이스에서 가져오는 API 엔드포인트 구현
2. 레스토랑 이름, 평점, 리뷰 수, 가격 범위, 카테고리 정보를 동적으로 표시하도록 Thymeleaf 템플릿 수정
3. 현재 영업 상태 및 영업 시간을 실시간으로 계산하여 표시하는 로직 구현
4. 레스토랑 배너 이미지 URL을 데이터베이스에서 가져와 동적으로 설정하는 기능 추가
-->
<div th:replace="fragments/restaurantBanner :: restaurantBanner(
        name='추형진의 양식집',
        rating='★★★★☆',
        reviewCount='1,234',
        price='₩₩',
        category='이탈리안 • 파스타 • 피자',
        status='영업중',
        hours='11:00 - 21:00'
    )"></div>

<div class="container">
    <div class="main-content">
        <nav class="tabs" role="tablist">
            <button class="tab active" data-tab="info" role="tab" aria-selected="true" aria-controls="info">
                <i class="fas fa-info-circle"></i> <span>정보</span>
            </button>
            <button class="tab" data-tab="reviews" role="tab" aria-selected="false" aria-controls="reviews">
                <i class="fas fa-star"></i> <span>리뷰</span>
            </button>
            <button class="tab" data-tab="inquiries" role="tab" aria-selected="false" aria-controls="inquiries">
                <i class="fas fa-question-circle"></i> <span>문의하기</span>
            </button>
            <button class="tab" data-tab="notices" role="tab" aria-selected="false" aria-controls="notices">
                <i class="fas fa-bullhorn"></i> <span>공지사항</span>
            </button>
        </nav>

        <!-- 신고 폼 -->
        <div class="report-modal-form">
            <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>신고하기</h2>
                    <span id="closeModalBtn" class="close-btn">X</span>
                </div>
                <div class="modal-body">
                    <form id="reportModalForm">
                        <div>
                            <label for="reportTile">신고 제목</label>
                            <input type="text" id="reportTile" name="reportTitle" required>
                        </div>
                        <div>
                            <label for="reportContent">신고 내용</label>
                            <textarea id="reportContent" name="reportContent" rows="3" required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="submit">신고</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        </div>
        <!-- 신고 폼 끝 -->

        <div class="content-area">
            <class="flex-container">
                <!-- 음식점 정보 탭 -->
                <div class="tab-content active" id="info" th:replace="fragments/restaurantDetail/info :: info"></div>
            <div class="tab-content" id="reviews" th:replace="fragments/restaurantDetail/reviews :: reviews"></div>
            <div class="tab-content" id="inquiries" th:replace="fragments/restaurantDetail/inquiries :: inquiries"></div>
            <div class="tab-content" id="notices" th:replace="fragments/restaurantDetail/notices :: notices"></div>

                <!-- TODO: 백엔드 - 문의 등록 API 구현 (POST /api/inquiries) -->
                <!-- TODO: 백엔드 - 문의 목록 조회 API 구현 (GET /api/inquiries?restaurantId=:id&page=:page&sort=:sort) -->
                <!-- TODO: 백엔드 - 문의 답변 등록 API 구현 (POST /api/inquiries/:id/replies) -->
                <!-- TODO: 백엔드 - 문의 좋아요 API 구현 (POST /api/inquiries/:id/like) -->
        </div>
    </div>
    <div class="sidebar-content">
        <div class="sidebar-info">
            <h3><i class="fas fa-info-circle"></i> 식당 정보</h3>
            <!-- TODO: 백엔드 - 식당 정보를 데이터베이스에서 가져와 동적으로 표시 -->
            <p><strong><i class="fas fa-globe"></i> 홈페이지:</strong> <a href="http://www.example.com">www.example.com</a>
            </p>
            <p><strong><i class="fas fa-phone"></i> 전화번호:</strong> 02-1234-5678</p>
            <p><strong><i class="fas fa-map-marker-alt"></i> 주소:</strong> 서울시 강남구 테헤란로 123</p>
        </div>
    </div>
</div>

<!-- 리뷰 모달 추가 -->
<div th:replace="~{fragments/modal :: modal('reviewModal', '리뷰 상세')}">
    <div th:fragment="content">
        <h3 id="modalReviewTitle"></h3>
        <p id="modalReviewContent"></p>
        <div id="modalReviewInfo"></div>
    </div>
</div>

<!-- 답변 모달 -->
<div th:replace="~{fragments/modal :: modal('replyModal', '답변 작성')}">
    <div th:fragment="content">
        <div class="reply-form">
            <textarea id="replyText" placeholder="답변을 작성해주세요." rows="4"></textarea>
            <button id="submitReply" class="submit-reply"><i class="fas fa-paper-plane"></i> 답변 등록</button>
        </div>
    </div>
</div>

<!-- 공지사항 작성 모달 추가 -->
<div th:replace="~{fragments/modal :: modal('noticeModal', '공지사항 작성')}">
    <div th:fragment="content">
        <div class="notice-form">
            <form id="noticeForm">
                <div class="form-group">
                    <label for="noticeTitle">제목</label>
                    <input type="text" id="noticeTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="noticeContent">내용</label>
                    <textarea id="noticeContent" name="content" rows="4" required></textarea>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">작성</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        kakao.maps.load(function () {
            let src = [];
            // 카카오맵 지도 렌더링을 위한 js파일 추가 - 음식점의 위치를 중앙으로
            src.push("/js/kakaoMapDetailView.js");

            for (let i = 0; i < src.length; i++) {
                let script = document.createElement("script");
                script.src = src[i];
                document.head.appendChild(script);
            }
        });


    }
</script>
    <script th:src="@{/js/restaurantDetail.js}"></script>
    <script th:src="@{/js/restaurantDetail/reviews.js}"></script>
    <script th:src="@{/js/restaurantDetail/info.js}"></script>
    <script th:src="@{/js/restaurantDetail/inquiries.js}"></script>
    <script th:src="@{/js/restaurantDetail/notices.js}"></script>
</body>
</html>