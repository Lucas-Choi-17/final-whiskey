<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/restaurantDetail.css">
    <link rel="stylesheet" href="/css/common.css"/>
    <th:block th:replace="fragments/header :: headerfiles"></th:block>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>FoodPolio - 음식점 상세 정보</title>
    <style>
    </style>
    <!-- <script>
        window.onload() = function () { 
            let src = [];
            src.push('/js/restaurantDetail.js');

                for (let i = 0; i < src.length; i++) {
                    let script = document.createElement('script');
                    script.src = src[i];
                    document.head.appendChild(script);

                }
         }
    </script> -->
    <script src="/js/restaurantDetail.js" defer></script>
</head>
<body>
    <div th:replace="fragments/header :: header"></div>
    
    <!-- TODO: 백엔드 개발
    1. 레스토랑 정보를 데이터베이스에서 가져오는 API 엔드포인트 구현
    2. 레스토랑 이름, 평점, 리뷰 수, 가격 범위, 카테고리 정보를 동적으로 표시하도록 Thymeleaf 템플릿 수정
    3. 현재 영업 상태 및 영업 시간을 실시간으로 계산하여 표시하는 로직 구현
    4. 레스토랑 배너 이미지 URL을 데이터베이스에서 가져와 동적으로 설정하는 기능 추가
    -->
    <div th:replace="fragments/restaurantBanner :: restaurantBanner(
        name='추형진의 양식집',
        rating='★★★★☆',
        reviewCount='1,234',
        price='₩₩',
        category='이탈리안 • 파스타 • 피자',
        status='영업중',
        hours='11:00 - 21:00'
    )"></div>
    
    <div class="container">
        <div class="main-content">
            <div class="tabs">
                <div class="tab active" data-tab="info">
                    <span>정보</span>
                </div>
                <div class="tab" data-tab="reviews">
                    <span>리뷰</span>
                </div>
                <div class="tab" data-tab="inquiries">
                    <span>문의하기</span>
                </div>
            </div>
            
            <div class="content-area">
                <div class="flex-container">
                    <div id="info" class="tab-content">
                        <div class="menu-section">
                            <h2>인기 메뉴</h2>
                            <!-- TODO: 백엔드 - 인기 메뉴 데이터를 데이터베이스에서 가져와 동적으로 표시 -->
                            <div class="menu-items-container">
                                <div class="menu-items">
                                    <div th:replace="fragments/menuItem :: menuItem('트러플 크림 파스타', '18,000')"></div>
                                    <div th:replace="fragments/menuItem :: menuItem('마르게리타 피자', '22,000')"></div>
                                    <!-- 추가 메뉴 아이템 -->
                                </div>
                            </div>
                            <!-- TODO: 백엔드 - '전체 메뉴 보기' 버튼 클릭 시 전체 메뉴 모달?로 이동하는 로직 구현 -->
                            <button class="view-full-menu">전체 메뉴 보기</button>
                        </div>      

                        <div class="tab-divider"></div>

                        <h2>위치 및 영업시간</h2>
                        <!-- TODO: 백엔드 - 네이버 또는 카카오 지도 API 연동 및 레스토랑 위치 표시 -->
                        <div class="map-placeholder">
                            카카오 지도 API가 여기에 표시(승인햄~)
                        </div>
                        <!-- TODO: 백엔드 - 영업시간 데이터를 데이터베이스에서 가져와 동적으로 표시 -->
                        <table class="hours-table">
                            <tr><td>월요일</td><td>11:00 AM - 11:00 PM</td></tr>
                            <tr><td>화요일</td><td>11:00 AM - 11:00 PM</td></tr>
                            <tr><td>수요일</td><td>11:00 AM - 11:00 PM</td></tr>
                            <tr><td>목요일</td><td>11:00 AM - 11:00 PM</td></tr>
                            <tr><td>금요일</td><td>11:00 AM - 12:00 AM (다음날)</td></tr>
                            <tr><td>토요일</td><td>11:00 AM - 12:00 AM (다음날)</td></tr>
                            <tr><td>일요일</td><td>11:00 AM - 11:00 PM</td></tr>
                        </table>

                        <div class="tab-divider"></div>
                        <div class="additional-info">
                            <h2>추가 정보</h2>
                            <!-- TODO: 백엔드 - 추가 정보를 데이터베이스에서 가져와 동적으로 표시 -->
                            <ul>
                                <li>주차 가능</li>
                                <li>무료 Wi-Fi</li>
                                <li>예약 권장</li>
                                <li>테이크아웃 가능</li>
                            </ul>
                        </div>
                        
                    </div>
                    
                    <div id="reviews" class="tab-content">
                        <h2>리뷰</h2>
                        <div class="review-summary">
                            <div class="review-cards">
                                <!-- TODO: 백엔드 - 전체 평점 및 리뷰 수를 계산하여 동적으로 표시 -->
                                <div class="review-card">
                                    <h3>전체 평점</h3>
                                    <div class="rating">★★★★☆ 4</div>
                                    <p>1,234 리뷰</p>
                                </div>
                            </div>
                        </div>
                        <div class="review-list">
                            <div class="popular-reviews">
                                <h3>인기 리뷰</h3>
                                <!-- TODO: 백엔드 - 인기 리뷰를 좋아요 수 기준으로 정렬하여 가져와 동적으로 표시 -->
                                <div class="popular-review-cards">
                                    <div class="popular-review-card">
                                        <div class="review-content">
                                            <h4>최고의 파스타 맛집!</h4>
                                            <p>트러플 크림 파스타가 정말 일품이에요. 분위기도 좋고 서비스도 친절해요.</p>
                                            <div class="review-footer">
                                                <span class="reviewer">작성자: 김맛있다</span>
                                                <span class="likes">👍 좋아요 128</span>
                                            </div>
                                        </div>
                                        <div class="image-placeholder">인기 리뷰 이미지</div>
                                    </div>
                                    <div class="popular-review-card">
                                        <div class="review-content">
                                            <h4>데이트 코스로 완벽해요</h4>
                                            <p>와인과 스테이크의 조화가 환상적이에요. 연인과 함께 오기 좋은 곳입니다.</p>
                                            <div class="review-footer">
                                                <span class="reviewer">작성자: 박데이트</span>
                                                <span class="likes">👍 좋아요 95</span>
                                            </div>
                                        </div>
                                        <div class="image-placeholder">인기 리뷰 이미지</div>
                                    </div>
                                </div>
                            </div>
                            <div class="recent-reviews">
                                <h3>최근 리뷰</h3>
                                <!-- TODO: 백엔드 - 최근 리뷰를 날짜순으로 정렬하여 가져와 동적으로 표시 -->
                                <div class="review-items">
                                    <!-- 리뷰 카드 fragment 사용 -->
                                    <div th:replace="fragments/reviewItem :: reviewItem(
                                        title='맛있는 파스타와 분위기 좋은 레스토랑',
                                        content='파스타가 정말 맛있었어요. 특히 트러플 크림 파스타는 꼭 드셔보세요!',
                                        author='홍길동',
                                        date='2024-05-01',
                                        rating='★★★★☆ 4',
                                        images='',
                                        menuName='트러플 크림 파스타',
                                        menuPrice='18,000'
                                    )" th:attr="data-review-id=${reviewId}"></div>
                                    <!-- 추가 리뷰 카드들... -->
                                </div>
                            </div>
                            <div class="write-review">
                                <!-- TODO: 백엔드 - 리뷰 작성 페이지로 이동하는 로직 구현 -->
                                <a href="/receipt-verification" class="write-review-button">리뷰 작성하기</a>
                            </div>
                        </div>
                    </div>
                    
                    <div id="inquiries" class="tab-content">
                        <h2>문의하기</h2>
                        <div class="inquiry-form">
                            <textarea id="inquiryText" placeholder="이 음식점에 대해 궁금한 점을 물어보세요." rows="4"></textarea>
                            <button id="submitInquiry" class="submit-inquiry">문의 등록</button>
                        </div>
                        <div class="inquiry-filter">
                            <select id="inquirySort">
                                <option value="recent">최신순</option>
                                <option value="popular">인기순</option>
                            </select>
                        </div>
                        <div class="recent-inquiries">
                            <!-- TODO: 백엔드 - 문의 목록을 데이터베이스에서 가져와 동적으로 표시 -->
                            <!-- TODO: 백엔드 - 각 문의에 대한 답변 데이터도 함께 가져와 표시 -->
                            <!-- 문의 아이템 fragment 사용 -->
                            <div th:replace="fragments/inquiryItem :: inquiryItem(
                                user='김철수',
                                location='서울시',
                                reviewCount=10,
                                photoCount=5,
                                question='주차 시설이 있나요?',
                                questionDate='2023년 5월 15일 14:30',
                                answer='네, 건물 뒤편에 무료 주차장이 마련되어 있습니다.',
                                answerUser='음식점 관리자',
                                answerDate='2023년 5월 15일 15:45'
                            )"></div>
                        </div>
                        <div class="inquiry-pagination">
                            <!-- TODO: 백엔드 - 페이지네이션 구현 (전체 문의 수에 따라 페이지 수 계산) -->
                            <button class="prev-page">이전</button>
                            <span class="current-page">1</span>
                            <button class="next-page">다음</button>
                        </div>
                    </div>

                    <!-- TODO: 백엔드 - 문의 등록 API 구현 (POST /api/inquiries) -->
                    <!-- TODO: 백엔드 - 문의 목록 조회 API 구현 (GET /api/inquiries?restaurantId=:id&page=:page&sort=:sort) -->
                    <!-- TODO: 백엔드 - 문의 답변 등록 API 구현 (POST /api/inquiries/:id/replies) -->
                    <!-- TODO: 백엔드 - 문의 좋아요 API 구현 (POST /api/inquiries/:id/like) -->                    
            
                </div>
            </div>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-info">
                <h3>식당 정보</h3>
                <!-- TODO: 백엔드 - 식당 정보를 데이터베이스에서 가져와 동적으로 표시 -->
                <p><strong>홈페이지:</strong> <a href="http://www.example.com">www.example.com</a></p>
                <p><strong>전화번호:</strong> 02-1234-5678</p>
                <p><strong>주소:</strong> 서울시 강남구 테헤란로 123</p>
            </div>
        </div>
    </div>

    <!-- 리뷰 모달 -->
    <div th:replace="~{fragments/modal :: modal('reviewModal', '리뷰 상세')}">
        <div th:fragment="content">
            <p id="modalReviewContent"></p>
            <div id="modalReviewInfo"></div>
        </div>
    </div>

    <!-- 답변 모달 -->
    <div th:replace="~{fragments/modal :: modal('replyModal', '답변 작성')}">
        <div th:fragment="content">
            <div class="reply-form">
                <textarea id="replyText" placeholder="답변을 작성해주세요." rows="4"></textarea>
                <button id="submitReply" class="submit-reply">답변 등록</button>
            </div>
        </div>
    </div>
</body>
</html>