<div th:fragment="editProfileModalBasic(member,profileImageUrl)" id="editProfileModalBasic" class="modal">
    <div class="modal-content">
        <span class="close">×</span>
        <h2>회원정보 수정</h2>
        <form id="editProfileFormBasic" class="basic-profile-form" action="/updateProfileBasic" method="post" enctype="multipart/form-data">
            <label for="basicLoginId">로그인 ID:</label>
            <div class="login-id-container">
                <input type="text" id="basicLoginId" name="loginId" th:value="${member.loginId}" required>
                <button type="button" id="loginIdCheckBtn">중복 확인</button>
            </div>
            <span id="loginId-check-message" style="color:red; display:none;"></span>

            <label for="basicName">이름:</label>
            <input type="text" id="basicName" name="name" th:value="${member.name}" required>

            <label for="basicNickname">닉네임:</label>
            <input type="text" id="basicNickname" name="nickname" th:value="${member.nickname}" required>

            <label for="basicEmail">이메일:</label>
            <input type="email" id="basicEmail" name="email" th:value="${member.email}" required>

            <label for="basicPassword">비밀번호:</label>
            <input type="password" id="basicPassword" name="password" placeholder="새 비밀번호">

            <label for="basicConfirmPassword">비밀번호 확인:</label>
            <input type="password" id="basicConfirmPassword" name="confirmPassword" placeholder="비밀번호 확인">

            <label for="basicIntroduction">자기소개:</label>
            <input type="text" id="basicIntroduction" name="introduction" th:value="${member.introduction != null ? member.introduction : ''}" placeholder="자기소개를 입력하세요">

            <!-- 프로필 사진 업로드 -->
            <label for="profileImage">프로필 이미지:</label>
            <input type="file" id="profileImage" name="profileImage" accept="image/*">

            <!-- 이미지 미리보기 -->
            <img id="profileImagePreview" th:src="${profileImageUrl}" alt="프로필 이미지 미리보기" class="profile-image" style="width: 150px; height: 150px; object-fit: cover; margin-top: 10px;">

            <button type="submit" id="submit-btn">저장</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 로그인 ID 중복 확인 로직
        document.getElementById('loginIdCheckBtn').addEventListener('click', function() {
            const loginId = document.getElementById('basicLoginId').value;

            if (!loginId) {
                alert('로그인 ID를 입력하세요.');
                return;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/checkLoginId', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    if (response.exists) {
                        alert('이미 사용 중인 로그인 ID입니다.');
                        document.getElementById('loginId-check-message').textContent = '이미 사용 중인 로그인 ID입니다.';
                        document.getElementById('loginId-check-message').style.color = 'red';
                        document.getElementById('loginId-check-message').style.display = 'block';
                        document.getElementById('submit-btn').disabled = true;
                    } else {
                        alert('사용 가능한 로그인 ID입니다.');
                        document.getElementById('loginId-check-message').textContent = '사용 가능한 로그인 ID입니다.';
                        document.getElementById('loginId-check-message').style.color = 'green';
                        document.getElementById('loginId-check-message').style.display = 'block';
                        document.getElementById('submit-btn').disabled = false;
                    }
                }
            };
            xhr.send('loginId=' + encodeURIComponent(loginId));
        });

        // 비밀번호 확인 로직
        document.getElementById('basicPassword').addEventListener('keyup', checkPasswords);
        document.getElementById('basicConfirmPassword').addEventListener('keyup', checkPasswords);

        function checkPasswords() {
            const password = document.getElementById('basicPassword').value;
            const confirmPassword = document.getElementById('basicConfirmPassword').value;

            if (password.length > 0 && password !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                document.getElementById('submit-btn').disabled = true;
            } else {
                document.getElementById('submit-btn').disabled = false;
            }
        }
    });
</script>
