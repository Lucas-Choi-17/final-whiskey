<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원 관리</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div id="userManagement">
    <div class="container mt-5">
        <h2>회원 관리</h2>

        <div class="card mt-3">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table report-table table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>이름</th>
                            <th>이메일</th>
                            <th>가입일</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tbody id="memberTableBody">
                        <!-- 서버에서 데이터를 가져와 이곳에 추가 -->
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- 페이지네이션 버튼들이 여기에 동적으로 추가됩니다 -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- 회원 데이터 템플릿 -->
<script type="text/template" id="member-template">
    <tr>
        <td>{{id}}</td>
        <td>{{name}}</td>
        <td>{{email}}</td>
        <td>{{createdAt}}</td>
        <td>
            <span class="{{activeClass}}">
                {{activeStatus}}
            </span>
        </td>
    </tr>
</script>

<!-- 페이지네이션 템플릿 -->
<script type="text/template" id="pagination-template">
    {{#if showPrevious}}
    <li class="page-item">
        <a class="page-link" href="#" data-page="{{previousPage}}">이전</a>
    </li>
    {{/if}}
    {{#each pages}}
    <li class="page-item {{#if isActive}}active{{/if}}">
        <a class="page-link" href="#" data-page="{{pageIndex}}">{{pageIndexDisplay}}</a>
    </li>
    {{/each}}
    {{#if showNext}}
    <li class="page-item">
        <a class="page-link" href="#" data-page="{{nextPage}}">다음</a>
    </li>
    {{/if}}
</script>

<script>
    $(document).ready(function () {
        // user-management 링크 클릭 시 데이터 로드
        $('[data-target="user-management"]').on('click', function(e) {
            e.preventDefault();
            loadMembers(0); // 첫 페이지를 로드

            // 회원 목록을 로드하는 함수
            function loadMembers(page) {
                $.ajax({
                    url: '/admin/user-management',
                    type: 'GET',
                    data: { page: page },
                    success: function(data) {
                        const tbody = $('#memberTableBody');
                        tbody.empty(); // 기존 데이터를 비움

                        // 회원 데이터를 테이블에 추가
                        const memberTemplate = $('#member-template').html();
                        data.content.forEach(function(member) {
                            const row = memberTemplate
                                .replace('{{id}}', member.id)
                                .replace('{{name}}', member.name)
                                .replace('{{email}}', member.email)
                                .replace('{{createdAt}}', new Date(member.createdAt).toLocaleDateString())
                                .replace('{{activeClass}}', member.active ? 'badge badge-success' : 'badge badge-secondary')
                                .replace('{{activeStatus}}', member.active ? '활성' : '비활성');
                            tbody.append(row);
                        });

                        // 페이지네이션 업데이트
                        const pagination = $('#pagination');
                        pagination.empty(); // 기존 페이지네이션 비움
                        const paginationTemplate = $('#pagination-template').html();

                        const paginationHtml = paginationTemplate
                            .replace('{{showPrevious}}', data.number > 0)
                            .replace('{{previousPage}}', data.number - 1)
                            .replace('{{showNext}}', data.number < data.totalPages - 1)
                            .replace('{{nextPage}}', data.number + 1)
                            .replace('{{pages}}', data.totalPages);

                        pagination.html(paginationHtml);
                        $('#page-title').text('회원 관리');
                    },
                    error: function(error) {
                        console.error('Error loading user management:', error);
                    }
                });
            }

            // 페이지네이션 클릭 이벤트 처리
            $(document).on('click', '.page-link', function(e) {
                e.preventDefault();
                const page = $(this).data('page');
                loadMembers(page);
            });
        });
    });
</script>

</body>
</html>
